# 보안 문제 근본 원인 분석

## 결론: 로컬 프로젝트 보안 취약점이 원인

### 발견된 문제

1. **Next.js RCE 취약점 (Critical)**
   - 버전: 15.3.3 (취약)
   - 취약점: Remote Code Execution 가능
   - 패치: 15.5.9로 업그레이드

2. **파일 업로드 보안 취약점**
   - 파일 확장자 검증 부족
   - MIME 타입 검증 부족
   - 경로 traversal 공격 방지 없음
   - 파일명 sanitization 없음

3. **Multer DoS 취약점 (High)**
   - 버전: 2.0.1 (취약)
   - 패치: 2.0.2로 업그레이드

### 공격 시나리오

1. **초기 침입 경로**
   - Next.js RCE 취약점을 통해 악성 코드 실행
   - 또는 파일 업로드 취약점을 통해 악성 파일 업로드 후 실행

2. **악성 코드 배포**
   - 해커가 악성 바이너리(`vmlunix`)를 서버에 배포
   - `/tmp/.VM-unix/vmlunix` 위치에 저장
   - Docker 컨테이너 내부에서 실행

3. **지속성 확보**
   - 오염된 Docker 이미지 생성
   - 컨테이너 재시작 시마다 악성 프로세스 자동 실행

### 왜 로컬 프로젝트가 원인인가?

1. **코드 자체는 깨끗했지만...**
   - 로컬 코드베이스에는 악성 코드가 없었음
   - 하지만 **보안 취약점**이 있었음

2. **취약점을 통한 침입**
   - Next.js RCE 취약점 → 서버에서 악성 코드 실행 가능
   - 파일 업로드 취약점 → 악성 파일 업로드 가능
   - 이 취약점들을 통해 해커가 침입

3. **오염된 이미지 배포**
   - 취약점이 있는 상태로 빌드된 이미지가 배포됨
   - 해커가 이 이미지를 악용하여 악성 코드 주입
   - 결과적으로 오염된 이미지가 서버에서 실행됨

### 해결 과정

1. **보안 취약점 패치**
   - Next.js 15.5.9로 업그레이드 (RCE 취약점 패치)
   - Multer 2.0.2로 업그레이드 (DoS 취약점 패치)
   - 파일 업로드 보안 강화

2. **오염된 이미지 제거**
   - 오염된 Docker 이미지 삭제
   - 깨끗한 이미지로 재배포

3. **모니터링 강화**
   - 악성 프로세스 자동 감지 스크립트 배포
   - 정기적인 보안 검사

### 교훈

1. **의존성 패키지 관리**
   - 정기적으로 `npm audit` 실행
   - 취약점 발견 시 즉시 업데이트

2. **파일 업로드 보안**
   - 항상 파일 확장자, MIME 타입 검증
   - 경로 traversal 공격 방지
   - 파일명 sanitization

3. **정기적인 보안 감사**
   - 코드 리뷰
   - 의존성 취약점 스캔
   - 서버 모니터링

### 결론

**로컬 프로젝트의 보안 취약점이 근본 원인이었습니다.**

- 코드 자체는 악성 코드가 아니었지만
- 보안 취약점(Next.js RCE, 파일 업로드 검증 부족)이 있었고
- 이 취약점을 통해 해커가 침입하여 악성 코드를 배포했으며
- 오염된 Docker 이미지가 서버에서 실행되었습니다

**현재 상태**: 모든 취약점이 패치되었고, 보안이 강화되었으며, 모니터링 시스템이 구축되었습니다.


